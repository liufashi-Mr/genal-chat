(function(e){function t(t){for(var n,a,s=t[0],c=t[1],i=t[2],d=0,p=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&p.push(o[a][0]),o[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);f&&f(t);while(p.length)p.shift()();return u.push.apply(u,i||[]),r()}function r(){for(var e,t=0;t<u.length;t++){for(var r=u[t],n=!0,a=1;a<r.length;a++){var s=r[a];0!==o[s]&&(n=!1)}n&&(u.splice(t--,1),e=c(c.s=r[0]))}return e}var n={},a={app:0},o={app:0},u=[];function s(e){return c.p+"js/"+({}[e]||e)+"."+{"chunk-366c7ac0":"90cc0041"}[e]+".js"}function c(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,c),r.l=!0,r.exports}c.e=function(e){var t=[],r={"chunk-366c7ac0":1};a[e]?t.push(a[e]):0!==a[e]&&r[e]&&t.push(a[e]=new Promise((function(t,r){for(var n="css/"+({}[e]||e)+"."+{"chunk-366c7ac0":"83552fe5"}[e]+".css",o=c.p+n,u=document.getElementsByTagName("link"),s=0;s<u.length;s++){var i=u[s],d=i.getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(d===n||d===o))return t()}var p=document.getElementsByTagName("style");for(s=0;s<p.length;s++){i=p[s],d=i.getAttribute("data-href");if(d===n||d===o)return t()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=t,f.onerror=function(t){var n=t&&t.target&&t.target.src||o,u=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");u.code="CSS_CHUNK_LOAD_FAILED",u.request=n,delete a[e],f.parentNode.removeChild(f),r(u)},f.href=o;var g=document.getElementsByTagName("head")[0];g.appendChild(f)})).then((function(){a[e]=0})));var n=o[e];if(0!==n)if(n)t.push(n[2]);else{var u=new Promise((function(t,r){n=o[e]=[t,r]}));t.push(n[2]=u);var i,d=document.createElement("script");d.charset="utf-8",d.timeout=120,c.nc&&d.setAttribute("nonce",c.nc),d.src=s(e);var p=new Error;i=function(t){d.onerror=d.onload=null,clearTimeout(f);var r=o[e];if(0!==r){if(r){var n=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;p.message="Loading chunk "+e+" failed.\n("+n+": "+a+")",p.name="ChunkLoadError",p.type=n,p.request=a,r[1](p)}o[e]=void 0}};var f=setTimeout((function(){i({type:"timeout",target:d})}),12e4);d.onerror=d.onload=i,document.head.appendChild(d)}return Promise.all(t)},c.m=e,c.c=n,c.d=function(e,t,r){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(c.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)c.d(r,n,function(t){return e[t]}.bind(null,n));return r},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/",c.oe=function(e){throw e};var i=window["webpackJsonp"]=window["webpackJsonp"]||[],d=i.push.bind(i);i.push=t,i=i.slice();for(var p=0;p<i.length;p++)t(i[p]);var f=d;u.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("cd49")},1:function(e,t){},2392:function(e,t,r){"use strict";var n=r("cebe"),a=r.n(n),o=(r("d3b7"),r("a78e")),u=r.n(o),s=function(e){var t=u.a.get("token");return e.headers.token=t,e},c=function(e){return Promise.reject(e)},i=function(e){return e},d=function(e){return Promise.reject(e)},p="/api",f=a.a.create({timeout:6e4,baseURL:p,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});f.interceptors.request.use(s,c),f.interceptors.response.use(i,d);t["a"]=f},"3fff":function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return a}));var n="阿童木聊天室",a="https://images.weserv.nl/?url=https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/453b8ebcdefa46a69c620da13f346ce2~tplv-k3u1fbpfcp-zoom-1.image?imageView2/2/w/800/q/85"},"48b8":function(e,t,r){"use strict";r.d(t,"g",(function(){return o})),r.d(t,"b",(function(){return u})),r.d(t,"e",(function(){return s})),r.d(t,"c",(function(){return c})),r.d(t,"a",(function(){return i})),r.d(t,"d",(function(){return d})),r.d(t,"f",(function(){return p}));r("c975"),r("4d63"),r("ac1f"),r("25f0");var n=r("8bbf"),a=r.n(n);function o(e){var t=e.data,r=t.code,n=t.msg,o=t.data;if(!r)return n&&a.a.prototype.$message.success(n),o;a.a.prototype.$message.error(n)}function u(e,t){return t.indexOf(e)>=0}function s(e){return e}function c(e){var t=new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/);return t.test(e)}function i(e){var t=a.a.prototype.$moment;return t().add(-1,"days").startOf("day")>e?t(e).format("M/D HH:mm"):t().startOf("day")>e?"昨天 "+t(e).format("HH:mm"):(new Date).valueOf()>e+3e5?t(e).format("HH:mm"):t(e).format("HH:mm:ss")}function d(e){var t=/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/;return 0===e.length?(a.a.prototype.$message.error("请输入名字"),!1):t.test(e)?!(e.length>9)||(a.a.prototype.$message.error("名字太长"),!1):(a.a.prototype.$message.error("名字只含有汉字、字母、数字和下划线 不能以下划线开头和结尾"),!1)}function p(e){var t=/^[0-9A-Z_a-z]+$/gi;return 0===e.length?(a.a.prototype.$message.error("请输入密码"),!1):t.test(e)?!(e.length>9)||(a.a.prototype.$message.error("密码太长"),!1):(a.a.prototype.$message.error("密码只含有字母、数字和下划线"),!1)}},5880:function(e,t){e.exports=Vuex},"5c0b":function(e,t,r){"use strict";var n=r("9c0c"),a=r.n(n);a.a},6389:function(e,t){e.exports=VueRouter},"8bbf":function(e,t){e.exports=Vue},"9c0c":function(e,t,r){},c32d:function(e,t){e.exports=moment},cd49:function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("8bbf"),a=r.n(n),o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("router-view"),e.background?r("img",{staticClass:"background",attrs:{src:e.background,alt:""}}):e._e()],1)},u=[],s=(r("ac1f"),r("466d"),r("498a"),r("d4ec")),c=r("bee2"),i=r("262e"),d=r("2caf"),p=r("9ab4"),f=r("60a3"),g=r("4bb5"),m=r("3fff"),l=Object(g["a"])("app"),h=function(e){Object(i["a"])(r,e);var t=Object(d["a"])(r);function r(){return Object(s["a"])(this,r),t.apply(this,arguments)}return Object(c["a"])(r,[{key:"mounted",value:function(){this.setMobile(this.isMobile()),this.background&&this.background.trim().length||this.set_background(m["a"])}},{key:"isMobile",value:function(){var e=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);return e&&e.length}}]),r}(f["c"]);Object(p["a"])([l.Getter("user")],h.prototype,"user",void 0),Object(p["a"])([l.Getter("background")],h.prototype,"background",void 0),Object(p["a"])([l.Mutation("set_mobile")],h.prototype,"setMobile",void 0),Object(p["a"])([l.Mutation("set_background")],h.prototype,"set_background",void 0),h=Object(p["a"])([f["a"]],h);var b=h,v=b,y=(r("5c0b"),r("2877")),I=Object(y["a"])(v,o,u,!1,null,null,null),O=I.exports,j=(r("d3b7"),r("6389")),k=r.n(j);a.a.use(k.a);var w,G,_=[{path:"/",name:"Chat",component:function(){return r.e("chunk-366c7ac0").then(r.bind(null,"edc5"))}}],x=new k.a({mode:"history",base:"/",routes:_}),$=x,R=r("5880"),S=r.n(R),P=r("5530"),M=(r("96cf"),r("1da1")),D="set_user",N="clear_user",C="set_token",E="set_mobile",T="set_background",A=r("2392"),H=r("48b8"),z={register:function(e,t){return Object(M["a"])(regeneratorRuntime.mark((function r(){var n,a,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,r.next=3,A["a"].post("/auth/register",Object(P["a"])({},t));case 3:if(a=r.sent,o=Object(H["g"])(a),!o){r.next=9;break}return n(D,o.user),n(C,o.token),r.abrupt("return",o);case 9:case"end":return r.stop()}}),r)})))()},login:function(e,t){return Object(M["a"])(regeneratorRuntime.mark((function r(){var n,a,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,r.next=3,A["a"].post("/auth/login",Object(P["a"])({},t));case 3:if(a=r.sent,o=Object(H["g"])(a),!o){r.next=9;break}return n(D,o.user),n(C,o.token),r.abrupt("return",o);case 9:case"end":return r.stop()}}),r)})))()}},B=z,L=r("ade3"),U=r("a78e"),F=r.n(U),q=(w={},Object(L["a"])(w,D,(function(e,t){e.user=t,F.a.set("user",t,{expires:3650})})),Object(L["a"])(w,N,(function(e){e.user={userId:"",username:"",password:"",avatar:"",createTime:0},F.a.set("user","")})),Object(L["a"])(w,C,(function(e,t){e.token=t,F.a.set("token",t,{expires:3})})),Object(L["a"])(w,E,(function(e,t){e.mobile=t})),Object(L["a"])(w,T,(function(e,t){e.background=t,localStorage.setItem("background",t)})),w),V=q,J={user:function(e){e.user;var t=F.a.get("user");return t?(e.user=JSON.parse(t),e.user):{}},mobile:function(e){return e.mobile},background:function(e){return e.background,localStorage.getItem("background")}},Q=J,W={user:{userId:"",username:"",password:"",avatar:"",createTime:0},token:"",mobile:!1,background:""},Z=W,K={namespaced:!0,state:Z,mutations:V,actions:B,getters:Q},X=K,Y=(r("99af"),r("b85c")),ee=r("8055"),te=r.n(ee),re="set_socket",ne="set_dropped",ae="set_active_group_user",oe="set_active_room",ue="set_user_gather",se="set_friend_gather",ce="set_group_gather",ie="add_group_message",de="set_group_messages",pe="add_friend_message",fe="set_friend_messages",ge="del_group",me="del_friend",le="set_unread_gather",he="lose_unread_gather",be={connectSocket:function(e,t){return Object(M["a"])(regeneratorRuntime.mark((function t(){var r,n,o,u,s,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=e.commit,n=e.state,o=e.dispatch,u=e.rootState,s=u.app.user,c=te.a.connect("/?userId=".concat(s.userId),{reconnection:!0}),c.on("connect",Object(M["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:c.emit("chatData",s),r(re,c);case 3:case"end":return e.stop()}}),e)})))),c.on("activeGroupUser",(function(e){r(ae,e.data)})),c.on("addGroup",(function(e){if(e.code)return a.a.prototype.$message.error(e.msg);a.a.prototype.$message.success(e.msg),r(ce,e.data)})),c.on("joinGroup",function(){var e=Object(M["a"])(regeneratorRuntime.mark((function e(t){var o,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.code){e.next=3;break}return e.abrupt("return",a.a.prototype.$message.error(t.msg));case 3:if(o=t.data.user,u=t.data.group,o.userId==s.userId){e.next=10;break}return r(ue,o),e.abrupt("return",a.a.prototype.$message.info("".concat(o.username,"加入群").concat(u.groupName)));case 10:n.groupGather[u.groupId]||(r(ce,u),c.emit("chatData",s)),a.a.prototype.$message.info("成功加入群".concat(u.groupName)),r(oe,n.groupGather[u.groupId]);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),c.on("joinGroupSocket",(function(e){if(e.code)return a.a.prototype.$message.error(e.msg);var t=e.data.user,o=e.data.group,u=n.friendGather;if(t.userId!=s.userId){var c;if(r(ue,t),u[t.userId])u[t.userId].messages&&(c=u[t.userId].messages),r(se,t),r(fe,c);if(window.msg===t.userId)return;return window.msg=t.userId,a.a.prototype.$message.info("".concat(t.username,"加入群").concat(o.groupName))}n.groupGather[o.groupId]||r(ce,o),r(ue,t)})),c.on("groupMessage",(function(e){if(e.code)a.a.prototype.$message.error(e.msg);else{r(ie,e.data);var t=n.activeRoom;t&&t.groupId!==e.data.groupId&&r(le,e.data.groupId)}})),c.on("addFriend",(function(e){e.code?a.a.prototype.$message.error(e.msg):(r(se,e.data),r(ue,e.data),a.a.prototype.$message.info(e.msg),c.emit("joinFriendSocket",{userId:s.userId,friendId:e.data.userId}))})),c.on("joinFriendSocket",(function(e){e.code})),c.on("friendMessage",(function(e){if(e.code)a.a.prototype.$message.error(e.msg);else if(e.data.friendId===s.userId||e.data.userId===s.userId){r(pe,e.data);var t=n.activeRoom;t&&t.userId!==e.data.userId&&t.userId!==e.data.friendId&&r(le,e.data.userId)}})),c.on("chatData",(function(e){if(e.code)return a.a.prototype.$message.error(e.msg);o("handleChatData",e.data),r(ne,!1)})),c.on("exitGroup",(function(e){e.code?a.a.prototype.$message.error(e.msg):(r(ge,e.data),r(oe,n.groupGather[m["b"]]),a.a.prototype.$message.success(e.msg))})),c.on("exitFriend",(function(e){e.code?a.a.prototype.$message.error(e.msg):(r(me,e.data),r(oe,n.groupGather[m["b"]]),a.a.prototype.$message.success(e.msg))}));case 15:case"end":return t.stop()}}),t)})))()},handleChatData:function(e,t){return Object(M["a"])(regeneratorRuntime.mark((function r(){var n,a,o,u,s,c,i,d,p,f,g,l,h,b,v,y,I,O,j,k,w;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=e.commit,e.dispatch,a=e.state,o=e.rootState,u=o.app.user,s=a.socket,c=a.groupGather,i=t.groupData,d=t.friendData,p=t.userData,i.length){f=Object(Y["a"])(i);try{for(f.s();!(g=f.n()).done;)l=g.value,s.emit("joinGroupSocket",{groupId:l.groupId,userId:u.userId}),n(ce,l)}catch(G){f.e(G)}finally{f.f()}}if(d.length){h=Object(Y["a"])(d);try{for(h.s();!(b=h.n()).done;)v=b.value,s.emit("joinFriendSocket",{userId:u.userId,friendId:v.userId}),n(se,v)}catch(G){h.e(G)}finally{h.f()}}if(p.length){y=Object(Y["a"])(p);try{for(y.s();!(I=y.n()).done;)O=I.value,n(ue,O)}catch(G){y.e(G)}finally{y.f()}}if(j=a.activeRoom,k=a.groupGather,w=a.friendGather,j){r.next=15;break}return r.abrupt("return",n(oe,c[m["b"]]));case 15:n(oe,k[j.groupId]||w[j.userId]);case 16:case"end":return r.stop()}}),r)})))()}},ve=be,ye=(r("07ac"),G={},Object(L["a"])(G,re,(function(e,t){e.socket=t})),Object(L["a"])(G,ne,(function(e,t){e.dropped=t})),Object(L["a"])(G,ae,(function(e,t){e.activeGroupUser=t;for(var r=e.userGather,n=0,o=Object.values(t[m["b"]]);n<o.length;n++){var u=o[n];a.a.set(r,u.userId,u)}})),Object(L["a"])(G,ie,(function(e,t){var r,n,o,u,s=this.getters["app/user"].userId;s!==t.userId&&a.a.prototype.$notice("\n      user:".concat(null===(r=e.userGather)||void 0===r||null===(n=r[null===t||void 0===t?void 0:t.userId])||void 0===n?void 0:n.username,",\n      group:").concat(null===(o=e.groupGather)||void 0===o||null===(u=o[null===t||void 0===t?void 0:t.groupId])||void 0===u?void 0:u.groupName,",\n      content:").concat(t.content,"\n    "));e.groupGather[t.groupId].messages?e.groupGather[t.groupId].messages.push(t):a.a.set(e.groupGather[t.groupId],"messages",[t])})),Object(L["a"])(G,de,(function(e,t){t&&t.length&&a.a.set(e.groupGather[t[0].groupId],"messages",t)})),Object(L["a"])(G,pe,(function(e,t){var r,n,o=this.getters["app/user"].userId;a.a.prototype.$notice("\n    user:".concat(null===(r=e.userGather)||void 0===r||null===(n=r[null===t||void 0===t?void 0:t.userId])||void 0===n?void 0:n.username,",\n    content:").concat(t.content,"\n  ")),t.friendId===o?e.friendGather[t.userId].messages?e.friendGather[t.userId].messages.push(t):a.a.set(e.friendGather[t.userId],"messages",[t]):e.friendGather[t.friendId].messages?e.friendGather[t.friendId].messages.push(t):a.a.set(e.friendGather[t.friendId],"messages",[t])})),Object(L["a"])(G,fe,(function(e,t){var r=this.getters["app/user"].userId;t&&t.length&&(t[0].friendId===r?a.a.set(e.friendGather[t[0].userId],"messages",t):a.a.set(e.friendGather[t[0].friendId],"messages",t))})),Object(L["a"])(G,oe,(function(e,t){e.activeRoom=t})),Object(L["a"])(G,ce,(function(e,t){a.a.set(e.groupGather,t.groupId,t)})),Object(L["a"])(G,ue,(function(e,t){a.a.set(e.userGather,t.userId,t)})),Object(L["a"])(G,se,(function(e,t){a.a.set(e.friendGather,t.userId,t)})),Object(L["a"])(G,ge,(function(e,t){a.a.delete(e.groupGather,t.groupId)})),Object(L["a"])(G,me,(function(e,t){a.a.delete(e.friendGather,t.friendId)})),Object(L["a"])(G,le,(function(e,t){e.unReadGather[t]?++e.unReadGather[t]:a.a.set(e.unReadGather,t,1)})),Object(L["a"])(G,he,(function(e,t){a.a.set(e.unReadGather,t,0)})),G),Ie=ye,Oe={socket:function(e){return e.socket},dropped:function(e){return e.dropped},activeGroupUser:function(e){return e.activeGroupUser},activeRoom:function(e){return e.activeRoom},groupGather:function(e){return e.groupGather},friendGather:function(e){return e.friendGather},userGather:function(e){return e.userGather},unReadGather:function(e){return e.unReadGather}},je=Oe,ke={socket:null,dropped:!1,activeGroupUser:{},activeRoom:null,groupGather:{},userGather:{},friendGather:{},unReadGather:{}},we=ke,Ge={namespaced:!0,state:we,mutations:Ie,actions:ve,getters:je},_e=Ge;a.a.use(S.a);var xe={app:X,chat:_e},$e=new S.a.Store({modules:xe}),Re=r("6944"),Se=r.n(Re),Pe=(r("3aed"),r("27fd")),Me=r("5efb"),De=r("b558"),Ne=r("ed3b"),Ce=r("3af3"),Ee=r("bb76"),Te=r("0c63"),Ae=r("ccb9"),He=r("681b"),ze=r("a600"),Be=r("55f1"),Le=r("cdeb"),Ue=r("9839"),Fe=r("39ab"),qe=r("f933"),Ve=r("9571"),Je=r("768f"),Qe=r("a071"),We=r("f64c");function Ze(e,t){var r=Date.now();return function(){var n=Date.now();n-r>=t&&(e.apply(void 0,arguments),r=Date.now())}}a.a.use(Pe["a"]),a.a.use(Me["a"]),a.a.use(De["a"]),a.a.use(Ne["a"]),a.a.use(Ce["a"]),a.a.use(Ee["a"]),a.a.use(Te["a"]),a.a.use(Ae["a"]),a.a.use(He["a"]),a.a.use(ze["a"]),a.a.use(Be["a"]),a.a.use(Le["a"]),a.a.use(Ue["a"]),a.a.use(Fe["a"]),a.a.use(qe["a"]),a.a.use(Ve["a"]),a.a.use(Je["a"]),a.a.use(Qe["a"]),a.a.prototype.$message=We["a"],a.a.prototype.$notice=Ze((function(e){function t(){var t=new Notification("",{body:e,icon:"https://pic1.zhuanstatic.com/zhuanzh/50b6ffe4-c7e3-4317-bc59-b2ec4931f325.png"});t.addEventListener("click",(function(e){open(location.href)}))}"granted"==window.Notification.permission?t():"denied"!=window.Notification.permission&&window.Notification.requestPermission((function(e){t()}))}),1e3);var Ke=r("c32d"),Xe=r.n(Ke);r("0808");a.a.config.productionTip=!1,a.a.prototype.$moment=Xe.a,a.a.use(Se.a,{defaultOptions:{navbar:!1,title:!1,toolbar:{zoomIn:1,zoomOut:1,oneToOne:4,reset:4,prev:0,next:0,rotateLeft:4,rotateRight:4,flipHorizontal:4,flipVertical:4}}}),new a.a({router:$,store:$e,render:function(e){return e(O)}}).$mount("#app")},cebe:function(e,t){e.exports=axios}});